@page "/queue"
@using Fip.Strive.Core.Domain.Schemas.Queue.Models

<MudStack Row="true" Justify="Justify.SpaceBetween">
    <MudText Typo="Typo.h1">Queue</MudText>
    @if (_isRunning)
    {
        <MudIconButton Icon="@Icons.Material.Filled.Pause" Color="Color.Primary" OnClick="@OnPauseRequested"/>
    }
    else
    {
        <MudIconButton Icon="@Icons.Material.Filled.PlayArrow" Color="Color.Primary" OnClick="@OnResumeRequested"/>
    }
</MudStack>
<MudGrid>
    <MudItem xs="3">
        <MudTable T="JobDetails" Context="job" ServerData="@OnUpcommingRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Available Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
                <MudTh>Status</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
                <MudTd DataLabel="Status">@job.Status</MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No matching records found</MudText>
            </NoRecordsContent>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>
    <MudItem xs="3">
        <MudTable T="JobDetails" Context="job" ServerData="@OnRunningRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Running Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No matching records found</MudText>
            </NoRecordsContent>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>
    <MudItem xs="3">
        <MudTable T="JobDetails" Context="job" ServerData="@OnSucceededRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Succeeded Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No matching records found</MudText>
            </NoRecordsContent>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>
    <MudItem xs="3">
        <MudTable T="JobDetails" Context="job" ServerData="@OnFailedRequested">
            <ToolBarContent>
                <MudText Typo="Typo.h2">Failed Jobs</MudText>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>Signalled</MudTh>
                <MudTh>Id</MudTh>
                <MudTh>Type</MudTh>
                <MudTh>Error</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Signalled">@job.SignalledAt</MudTd>
                <MudTd DataLabel="Id">@job.Id</MudTd>
                <MudTd DataLabel="Type">@job.Type</MudTd>
                <MudTd DataLabel="Error">
                    <MudIconButton Icon="@Icons.Material.Rounded.Info" OnClick="@(() => OnOpenErrorDialog(job))" Size="Size.Small" />
                </MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No matching records found</MudText>
            </NoRecordsContent>
            <PagerContent>
                <MudTablePager/>
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>

<MudDialog @bind-Visible="_dialogVisible" Options="_dialogOptions" >
    <TitleContent>
        <MudText Typo="Typo.h6">Error Details</MudText>
    </TitleContent>
    <DialogContent>
        <MudText Typo="Typo.button" Inline="false">Stack Trace</MudText>
        <MudText Class="pb-5">@_selectedError</MudText>
        <MudText Typo="Typo.button" Inline="false">Payload</MudText>
        <MudText>@_selectedPayload</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@(() => _dialogVisible = false)">Close</MudButton>
    </DialogActions>
</MudDialog>