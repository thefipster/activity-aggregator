@using System.Runtime.InteropServices.JavaScript
@using TheFipster.ActivityAggregator.Domain.Tools
<MudCard Class="flex-1">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">Uploads</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudIconButton Color="Color.Primary" OnClick="OnSyncClickedAsync"
                           Icon="@Icons.Material.Outlined.Sync">
            </MudIconButton>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent Class="d-flex align-center">
        @if (indexes.Any())
        {
            <MudTable Loading="@indexLoading" Items="indexes" Elevation="0" Style="width: 100%">
                <HeaderContent>
                    <MudTh>Indexing Date</MudTh>
                    <MudTh>First indexed file</MudTh>
                    <MudTh>Zip size</MudTh>
                    <MudTh>File count</MudTh>
                    <MudTh>File size</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Indexing Date">@context.IndexedAt.ToString(DateHelper.UiMinuteFormat)</MudTd>
                    <MudTd DataLabel="First indexed file">@context.Files.FirstOrDefault()
                        <MudTooltip Placement="Placement.Top" Arrow="true">
                            <ChildContent>
                                @(context.Files.Count > 1 ? $"({context.Files.Count - 1} more)" : string.Empty)
                            </ChildContent>
                            <TooltipContent>
                                <MudText Typo="Typo.h6">All referenced files</MudText>
                                @foreach (var file in context.Files)
                                {
                                    <MudText Typo="Typo.body1">@file</MudText>
                                }
                            </TooltipContent>
                        </MudTooltip>
                    </MudTd>
                    <MudTd DataLabel="Zip size">
                        <FipFileSize Size="@context.PackedSize"></FipFileSize>
                    </MudTd>
                    <MudTd DataLabel="File count">
                        @context.Count
                    </MudTd>
                    <MudTd DataLabel="File size">
                    <FipFileSize Size="@context.UnpackedSize"></FipFileSize>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new[] { 50 }"
                                   HideRowsPerPage="true" />
                </PagerContent>
            </MudTable>
        }
        else
        {
            <MudText Class="py-10" Typo="Typo.body1">Upload something... come on what are you waiting for.</MudText>
        }
    </MudCardContent>
</MudCard>