<MudContainer Class="ma-5 pa-5 d-flex flex-column gap-5 flex-grow-1" Fixed="true">
    <MudCard>
        <MudCardHeader>
            <CardHeaderContent>
                    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                        <MudText Typo="Typo.h4">Upload zip file</MudText>
                        <MudText>@_fileName</MudText>
                        <MudFileUpload @key="_uploadKey" T="IBrowserFile" Accept="@Filter"
                                       FilesChanged="@OnFilesChanged">
                            <ActivatorContent>
                                <MudIconButton Color="Color.Primary"
                                               Disabled="@_uploadDisabled"
                                               Icon="@Icons.Material.Outlined.Upload">
                                </MudIconButton>
                            </ActivatorContent>
                        </MudFileUpload>
                    </MudStack>
            </CardHeaderContent>
        </MudCardHeader>
        
        <MudProgressLinear Class="" Color="Color.Primary" Value="@_progress"/>

        <MudCardContent Class="d-flex align-center">
            <MudTable @ref="_fileTable" Context="item" ServerData="@LoadServerData"
                      CustomHeader="true" Elevation="0" Style="width: 100%">
                <HeaderContent>
                    <MudTHeadRow>
                        <MudTh></MudTh>
                        <MudTh>
                            <MudTextField T="string" Placeholder="Search" Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Search" ValueChanged="@OnSearchFilterChanged" IconSize="Size.Small"
                                          Class="mt-0"></MudTextField>
                        </MudTh>
                        <MudTh></MudTh>
                        <MudTh></MudTh>
                        <MudTh></MudTh>
                    </MudTHeadRow>
                        <MudTHeadRow>
                        <MudTh Style="width:160px;">Upload date</MudTh>
                        <MudTh>File</MudTh>
                        <MudTh Style="width:100px;">Zip size</MudTh>
                        <MudTh Style="width:100px;">File count</MudTh>
                        <MudTh Style="width:140px;">Total File size</MudTh>
                    </MudTHeadRow>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Upload date">
                        <MudText Typo="Typo.body1">@item.IndexedAt.ToString(DateHelper.UiMinuteFormat)</MudText>
                    </MudTd>
                    <MudTd DataLabel="File">
                        <MudText Typo="Typo.body1">@(new FileInfo(item.ZipPath).Name)</MudText>
                        @if (item.AlternateFiles.Any())
                        {
                            <MudTooltip Placement="Placement.Top" Arrow="true">
                                <ChildContent>
                                    @(item.AlternateFiles.Count > 1 ? $"({item.AlternateFiles.Count - 1} more)" : string.Empty)
                                </ChildContent>
                                <TooltipContent>
                                    <MudText Typo="Typo.subtitle2">All referenced files</MudText>
                                    @foreach (var file in item.AlternateFiles)
                                    {
                                        <MudText Typo="Typo.body2">@file</MudText>
                                    }
                                </TooltipContent>
                            </MudTooltip>
                        }
                    </MudTd>
                    <MudTd DataLabel="Zip size">
                        <FipFileSize Typo="Typo.body1" Size="@item.PackedSize"></FipFileSize>
                    </MudTd>
                    <MudTd DataLabel="File count">
                        <MudText Typo="Typo.body1">
                            @item.FileCount
                        </MudText>
                    </MudTd>
                    <MudTd DataLabel="File size">
                        <FipFileSize Typo="Typo.body1" Size="@item.UnpackedSize"></FipFileSize>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new[] { 50 }"
                                   HideRowsPerPage="true"/>
                </PagerContent>
            </MudTable>
        </MudCardContent>
    </MudCard>
</MudContainer>