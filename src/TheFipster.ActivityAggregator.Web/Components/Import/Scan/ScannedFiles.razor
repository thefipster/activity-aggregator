@using TheFipster.ActivityAggregator.Domain.Tools

@if (!string.IsNullOrWhiteSpace(Hash))
{
    <MudCard Class="flex-1">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">Files</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudCardContent Class="d-flex align-center">
            <MudTable Loading="@isLoading" Items="indexes" Elevation="0" Style="width: 100%">
                <HeaderContent>
                    <MudTh>Index time</MudTh>
                    <MudTh>File</MudTh>
                    <MudTh>Type</MudTh>
                    <MudTh>Date</MudTh>
                    <MudTh>Range</MudTh>
                    <MudTh>Last Action</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Index time">@context.IndexedAt.ToString(DateHelper.UiSecondFormat)</MudTd>
                    <MudTd DataLabel="File">
                        @context.Files.FirstOrDefault()
                        <MudTooltip Placement="Placement.Top" Arrow="true">
                            <ChildContent>
                                @(context.Files.Count > 1 ? $"({context.Files.Count - 1} more)" : string.Empty)
                            </ChildContent>
                            <TooltipContent>
                                <MudText Typo="Typo.body1">All referenced files</MudText>
                                @foreach (var file in context.Files)
                                {
                                    <MudText Typo="Typo.body2">@file</MudText>
                                }
                            </TooltipContent>
                        </MudTooltip>
                    </MudTd>
                    <MudTd DataLabel="Type">
                        @if (context.Classification == null)
                        {
                            <MudText Typo="Typo.body1">---</MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.body1">@context.Classification.Source</MudText>
                        }
                    </MudTd>
                    <MudTd DataLabel="Date">
                        @if (context.Classification == null)
                        {
                            <MudText Typo="Typo.body1">---</MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.body1">@context.Classification.Datetime.ToString(DateHelper.UiDayFormat)</MudText>
                        }
                    </MudTd>
                    <MudTd DataLabel="Range">
                        @if (context.Classification == null)
                        {
                            <MudText Typo="Typo.body1">---</MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.body1">@context.Classification.Range</MudText>
                        }
                    </MudTd>
                    <MudTd DataLabel="Last Action">
                        @if (context.Actions.Any())
                        {
                            <MudText
                                Typo="Typo.body1">@context.Actions.OrderByDescending(x => x.Key).First().Value</MudText>
                        }
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new[] { 15 }"
                                   HideRowsPerPage="true"/>
                </PagerContent>
            </MudTable>
        </MudCardContent>
    </MudCard>
}