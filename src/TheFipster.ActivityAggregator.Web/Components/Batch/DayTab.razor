<MudContainer Class="ma-5 pa-5 d-flex flex-column gap-5" Fixed="true">
    @if (Batch != null)
    {
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                        <MudText Typo="Typo.h4">Batch
                            <smaller>@($"{Batch.Timestamp:dd.MM.yyyy}")</smaller>
                        </MudText>
                        <MudIconButton Color="Color.Primary" OnClick="@OnBackClicked"
                                       Icon="@Icons.Material.Outlined.ArrowBack">
                        </MudIconButton>
                    </MudStack>
                </CardHeaderContent>
            </MudCardHeader>
            <MudProgressLinear></MudProgressLinear>
            <MudCardContent>
                @if (_history != null)
                {
                    <MudText Class="mb-4" Typo="Typo.h5">Import History</MudText>
                    <MudTable Hover="true"
                              Items="@_indexes"
                              GroupBy="@_groupDefinition"
                              Dense="true">
                        <HeaderContent>
                            <MudTh Style="width:180px;">Hash</MudTh>
                            <MudTh>Path</MudTh>
                            <MudTh Style="width:180px;">Timestamp</MudTh>
                            <MudTh Style="width:160px;">Type</MudTh>
                            <MudTh Style="width:180px;">Indexed</MudTh>
                        </HeaderContent>
                        <GroupHeaderTemplate>
                            <MudTh Class="mud-table-cell-custom-group"
                                   colspan="5">@($"{context.GroupName}: {context.Key}")</MudTh>
                        </GroupHeaderTemplate>
                        <RowTemplate>
                            <MudTd DataLabel="Hash">@context.Hash</MudTd>
                            <MudTd DataLabel="Path">@(new FileInfo(context.Path).Name)</MudTd>
                            <MudTd DataLabel="Timestamp">@context.Timestamp</MudTd>
                            <MudTd DataLabel="Type">@context.TimeType</MudTd>
                            <MudTd DataLabel="Indexed">@context.IndexedAt</MudTd>
                        </RowTemplate>
                    </MudTable>
                }

                                @if (_mergedFile != null)
                {
                    <MudText Class="mt-8 mb-4" Typo="Typo.h5">Merged File</MudText>
                    @if (_mergedFile.Metrics != null)
                    {
                        @if (_mergedFile.Metrics.Resolved.Any())
                        {
                            <MudText Class="mb-2" Typo="Typo.h6">Metrics</MudText>
                            <MudTable Hover="true"
                                      Items="@_mergedFile.Metrics.Resolved.ToList()"
                                      Dense="true">
                                <HeaderContent>
                                    <MudTh Style="width:200px;">Parameter</MudTh>
                                    <MudTh>Value</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Parameter">@context.Key</MudTd>
                                    <MudTd DataLabel="Value">@context.Value</MudTd>
                                </RowTemplate>
                            </MudTable>
                        }
                        
                        @if (_mergedFile.Metrics.Conflicts.Any())
                        {
                            <MudText Class="mt-4 mb-2" Typo="Typo.h6">Conflicts</MudText>
                            <MudTable Hover="true"
                                      Items="@_mergedFile.Metrics.Conflicts.ToList()"
                                      Dense="true">
                                <HeaderContent>
                                    <MudTh Style="width:200px;">Parameter</MudTh>
                                    <MudTh>Values</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Parameter">@context.Key</MudTd>
                                    <MudTd DataLabel="Value">@string.Join(", ", context.Value)</MudTd>
                                </RowTemplate>
                            </MudTable>
                        }
                    }

                    @if (_mergedFile.Samples.Any())
                    {
                        <MudText Class="mt-4 mb-2" Typo="Typo.h6">Samples</MudText>
                        <MudTable Hover="true"
                                  Items="@_mergedFile.Samples.Where(x => x != null).Select(x => x!)"
                                  Dense="true">
                            <HeaderContent>
                                <MudTh Style="width:200px;">Type</MudTh>
                                <MudTh Style="width:200px;">Start</MudTh>
                                <MudTh Style="width:200px;">End</MudTh>
                                <MudTh>Parameters</MudTh>
                            </HeaderContent>
                            <RowTemplate>
                                <MudTd DataLabel="Type">@context.Type</MudTd>
                                <MudTd DataLabel="Start">@context.Start</MudTd>
                                <MudTd DataLabel="End">@context.End</MudTd>
                                <MudTd DataLabel="Parameters">@string.Join(", ", context.Values.Keys)</MudTd>
                            </RowTemplate>
                        </MudTable>
                    }

                    @if (_mergedFile.Tracks.Any())
                    {
                        <MudText Class="mt-4 mb-2" Typo="Typo.h6">Tracks</MudText>
                        <MudTable Hover="true"
                                  Items="@_mergedFile.Tracks.Where(x => x != null).Select(x => x!)"
                                  Dense="true">
                            <HeaderContent>
                                <MudTh Style="width:200px;">Type</MudTh>
                                <MudTh>Points</MudTh>
                            </HeaderContent>
                            <RowTemplate>
                                <MudTd DataLabel="Type">@context.Type</MudTd>
                                <MudTd DataLabel="Points">@context.Points.Count</MudTd>
                            </RowTemplate>
                        </MudTable>
                    }

                    @if (_mergedFile.Pulses.Any())
                    {
                        <MudText Class="mt-4 mb-2" Typo="Typo.h6">RR Intervals</MudText>
                        <MudTable Hover="true"
                                  Items="@_mergedFile.Pulses.Where(x => x != null).Select(x => x!)"
                                  Dense="true">
                            <HeaderContent>
                                <MudTh>Heartbeats</MudTh>
                            </HeaderContent>
                            <RowTemplate>
                                <MudTd DataLabel="Heartbeats">@context.Count</MudTd>
                            </RowTemplate>
                        </MudTable>
                    }

                    @if (_mergedFile.Events != null)
                    {
                        @if (_mergedFile.Events.Resolved.Any())
                        {
                            <MudText Class="mt-4 mb-2" Typo="Typo.h6">Events</MudText>
                            <MudTable Hover="true"
                                      Items="@_mergedFile.Events.Resolved"
                                      Dense="true">
                                <HeaderContent>
                                    <MudTh Style="width:200px;">Timestamp</MudTh>
                                    <MudTh Style="width:200px;">Type</MudTh>
                                    <MudTh Style="width:200px;">Message</MudTh>
                                    <MudTh>Parameters</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Timestamp">@context.Timestamp</MudTd>
                                    <MudTd DataLabel="Type">@context.Type</MudTd>
                                    <MudTd DataLabel="Message">@context.Message</MudTd>
                                    <MudTd DataLabel="Parameters">@(string.Join(", ", context.Values.Keys))</MudTd>
                                </RowTemplate>
                            </MudTable>
                        }
                    }
                }
            </MudCardContent>
        </MudCard>
    }
</MudContainer>