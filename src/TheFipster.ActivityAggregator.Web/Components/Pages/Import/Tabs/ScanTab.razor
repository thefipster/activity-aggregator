@using TheFipster.ActivityAggregator.Domain.Models.Options
<MudContainer Class="ma-5 pa-5 d-flex flex-column gap-5" Fixed="true">
    <MudCard>
        <MudCardHeader>
            <CardHeaderContent>
                <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                    <MudText Typo="Typo.h4">Scan unzipped files</MudText>
                    <MudIconButton Color="Color.Primary"
                                   OnClick="@OnScanClicked"
                                   Icon="@Icons.Material.Outlined.Radar"/>
                </MudStack>
            </CardHeaderContent>
        </MudCardHeader>
        <MudProgressLinear Color="Color.Primary" />
        <MudCardContent>
            <MudTable T="FileIndex" @ref="_fileTable" ServerData="@LoadServerData" CustomHeader="true"
                      RowsPerPage="10" Loading="false" Hover="true" Elevation="0" Style="width: 100%">
                <HeaderContent>
                    <MudTHeadRow>
                        <MudTh></MudTh>
                        <MudTh>
                            <MudTextField T="string" Label="Filename" Placeholder="Search"
                                          ValueChanged="@(s => OnSearch(s))"
                                          Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                                          IconSize="Size.Small" Class="mt-0"></MudTextField>
                        </MudTh>
                        <MudTh>
                            <MudSelect T="string" Label="Classification" ValueChanged="@OnClassificationFilterChanged">
                                <MudSelectItem Value="@ClassificationOptions.All">All Files</MudSelectItem>
                                <MudSelectItem Disabled="true" Value="@("General-Topic")">General</MudSelectItem>
                                <MudSelectItem Value="@ClassificationOptions.Classified">Classified Files
                                </MudSelectItem>
                                <MudSelectItem Value="@ClassificationOptions.Unclassified">Unclassified Files
                                </MudSelectItem>
                                <MudSelectItem Disabled="true" Value="@("Special-Topic")">Special</MudSelectItem>
                                @if (_classifiers != null)
                                {
                                    @foreach (var classifier in _classifiers)
                                    {
                                        <MudSelectItem Value="@classifier">@classifier</MudSelectItem>
                                    }
                                }
                            </MudSelect>
                        </MudTh>
                        <MudTh colspan="2">
                            <MudSelect T="string" Label="Range" ValueChanged="@OnRangeFilterChanged">
                                <MudSelectItem Value="@RangeOptions.All">All Files</MudSelectItem>
                                <MudSelectItem Disabled="true" Value="@("Special-Topic")">Special</MudSelectItem>
                                @foreach (var range in _ranges)
                                {
                                    <MudSelectItem Value="@range">@range</MudSelectItem>
                                }
                            </MudSelect>
                        </MudTh>
                        <MudTh></MudTh>
                    </MudTHeadRow>
                    <MudTHeadRow>
                        <MudTh Style="width:160px;">Indexed</MudTh>
                        <MudTh>File</MudTh> <!-- this one grows -->
                        <MudTh Style="width:300px;">Classification</MudTh>
                        <MudTh Style="width:100px;">Range</MudTh>
                        <MudTh Style="width:160px;">Timestamp</MudTh>
                        <MudTh Style="width:100px;">Size</MudTh>
                    </MudTHeadRow>
                </HeaderContent>
                <RowTemplate>
                    <MudTd>@context.IndexedAt.ToLocalTime().ToString("g")</MudTd>
                    <MudTd>@(new FileInfo(context.Path).Name)</MudTd>
                    <MudTd>@context.Source</MudTd>
                    <MudTd>@context.Range</MudTd>
                    <MudTd>@(context.Timestamp.HasValue ? context.Timestamp.Value.ToString("g") : string.Empty)</MudTd>
                    <MudTd>
                        <FipFileSize Typo="Typo.body1" Size="@context.Size"></FipFileSize>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager/>
                </PagerContent>
            </MudTable>
        </MudCardContent>
    </MudCard>
</MudContainer>