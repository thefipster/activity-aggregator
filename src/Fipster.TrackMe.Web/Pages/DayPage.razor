@page "/day/{dateValue}"

@using Fipster.TrackMe.Domain

@inject ApiService Api
@inject NavigationManager NavigationManager

<MudContainer Class="d-flex flex-column align-start gap-5" Fixed="true">

    <MudContainer Class="d-flex align-center gap-5" Fixed="true">
        <MudIconButton OnClick="NavigateToPreviousDay" Icon="@Icons.Material.Outlined.ArrowBack" Size="Size.Large"></MudIconButton>
        <MudText Typo="Typo.h5">@(Date.HasValue ? Date.Value.ToString("dd MMMM yyyy") : "")</MudText>
        <MudIconButton OnClick="NavigateToNextDay" Icon="@Icons.Material.Outlined.ArrowForward" Size="Size.Large"></MudIconButton>
    </MudContainer>

    <MudButton Href="@("/calendar/" + DateValue)" Variant="Variant.Text">Back to Calendar</MudButton>

    @if (Data != null)
    {
        @if (Data.Any(x => x.Range == DateRanges.Day))
        {
            <MudText Typo="Typo.h6">Daily Activity</MudText>
            <MudButton OnClick="MergeClicked">Merge</MudButton>
            <MudTable Items="@Data.Where(x => x.Range == DateRanges.Day).OrderBy(x => x.Timestamp)" Hover="true"
                      Breakpoint="Breakpoint.Sm">
                <HeaderContent>
                    <MudTh>Date</MudTh>
                    <MudTh>Range</MudTh>
                    <MudTh>Source</MudTh>
                    <MudTh>Attributes</MudTh>
                    <MudTh>Series</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Date">@context.Timestamp.ToString("yyyy-MM-dd HH:mm")</MudTd>
                    <MudTd DataLabel="Range">@context.Range</MudTd>
                    <MudTd DataLabel="Source">@context.Source</MudTd>
                    <MudTd DataLabel="Attributes">@string.Join(", ", context.Attributes.Keys)</MudTd>
                    <MudTd DataLabel="Series">@string.Join(", ", context.Series.Keys)</MudTd>
                </RowTemplate>
            </MudTable>
        }
        @if (Data.Any(x => x.Range == DateRanges.Time))
        {
            <MudText Typo="Typo.h6">Sport Sessions</MudText>
            <MudTable Items="@Data.Where(x => x.Range == DateRanges.Time).OrderBy(x => x.Timestamp)" Hover="true"
                      Breakpoint="Breakpoint.Sm">
                <HeaderContent>
                    <MudTh>Date</MudTh>
                    <MudTh>Range</MudTh>
                    <MudTh>Source</MudTh>
                    <MudTh>Attributes</MudTh>
                    <MudTh>Series</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Date">@context.Timestamp.ToString("yyyy-MM-dd HH:mm")</MudTd>
                    <MudTd DataLabel="Range">@context.Range</MudTd>
                    <MudTd DataLabel="Source">@context.Source</MudTd>
                    <MudTd DataLabel="Attributes">@string.Join(", ", context.Attributes.Keys)</MudTd>
                    <MudTd DataLabel="Series">@string.Join(", ", context.Series.Keys)</MudTd>
                </RowTemplate>
            </MudTable>
        }
    }

</MudContainer>
